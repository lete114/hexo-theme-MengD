var local_search=document.getElementById("local_search"),html=document.querySelector("html"),mask=document.getElementById("mask"),is_load=!1,search=function(e,l,s){is_load=!0,fetch(e).then(e=>e.text()).then(e=>(new window.DOMParser).parseFromString(e,"text/xml")).then(function(e){var t=[...e.querySelectorAll("entry")].map(function(e){return{title:e.querySelector("title").textContent,content:e.querySelector("content").textContent,url:e.querySelector("url").textContent}}),e=document.getElementById(l),a=document.getElementById(s);e.addEventListener("input",function(){var h='<ul class="search_result_list">',u=this.value.trim().toLowerCase().split(/[\s\-]+/);a.innerHTML="",this.value.trim().length<=0||(t.forEach(function(e){var a=!0;e.title&&""!==e.title.trim()||(e.title="Untitled");var l,t,s,n,c=e.title.trim().toLowerCase(),r=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=e.url.startsWith("/")?e.url:"/"+e.url,i=-1,m=-1;""!==r?u.forEach(function(e,t){l=c.indexOf(e),i=r.indexOf(e),l<0&&i<0?a=!1:(i<0&&(i=0),0==t&&(m=i))}):a=!1,a&&(t=e.content.trim().replace(/<[^>]+>/g,""),0<=m&&(s=m+80,(s=0==(e=(e=m-20)<0?0:e)?100:s)>t.length&&(s=t.length),n=t.substring(e,s),u.forEach(function(e){var t=new RegExp(e,"gi");n=n.replace(t,'<span class="search_keyword">'+e+"</span>"),c=c.replace(t,'<span class="search_keyword">'+e+"</span>")}),h+="<li><a href='"+o+"' class='search_result_title'>"+c+"</a>",h+='<p class="search_result">'+n+"...</p>"),h+="</li>")}),h+="</ul>",a.innerHTML=h,window.pjax&&window.pjax.refresh(a))})})};document.getElementsByClassName("search_btn")[0].onclick=function(){is_load||search($config.search_file,"local_search_input","local_search_result"),mask.className="mask",local_search.style.display||(local_search.style.display="block",html.style.overflow="hidden",local_search.classList.remove("search_animation_min"),local_search.classList.add("search_animation_max"),document.getElementById("local_search_input").focus())},document.querySelector(".search_close_button").onclick=function(){local_search.classList.remove("search_animation_max"),local_search.classList.add("search_animation_min"),mask.classList.remove("mask"),html.style.overflow="auto",setTimeout(function(){local_search.style.display=""},500)},window.addEventListener("pjax:complete",function(){"none"===local_search.style.display&&(mask.className="")});